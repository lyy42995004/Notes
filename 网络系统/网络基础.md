# 网络基础

## 网络协议

### OSI七层模型
​                                                                                <img src="https://s2.loli.net/2024/09/30/LUQXjRS5mYnJBec.png" style="zoom:50%;" />
OSI（Open Systems Interconnection，开放系统互联）模型是由国际标准化组织（ISO)提出的网络通信模型，定义了网络系统的分层结构，用于标准化不同计算机系统之间的通信。OSI模型将网络通信过程分为七个层次，每一层都有特定的功能和协议，用于处理网络通信中的不同方面。通过这种分层的设计，各个层次的实现相对独立，可以更灵活地实现和修改网络协议。

||名称|功能|功能概览|
|---|:-----:|:---------------------:|:-----------:|
|7|应用层|为用户提供各种网络应用服务，如电子邮件、文件传输、网页浏览等。它直接与用户的应用程序交互，通过调用下层的协议和服务来实现特定的应用功能。|![](https://s2.loli.net/2024/09/30/2RqsvSg3dn4oZCk.png)|
|6|表示层|设备固有数据格式和网络标准数据格式的转换。它处理数据的加密、解密、压缩、编码转换等问题，使得不同系统之间的数据可以互相理解。|![](https://s2.loli.net/2024/09/30/VtG3nk2bSWLd7q9.png)|
|5|会话层|负责建立、管理和终止应用程序之间的通信会话。它处理会话的创建、维护、同步等问题，并确保通信不会被中断。|![](https://s2.loli.net/2024/09/30/PnCwmxXcKR6MJS9.png)|
|4|传输层|确保数据在源节点和目标节点之间可靠传输，负责数据的分段、传输控制、错误检测与恢复、流量控制等。它提供端到端的通信服务。|![](https://s2.loli.net/2024/09/30/h9H4wntzFxADd8S.png)|
|3|网络层|网络层负责选择最佳路径并管理数据的传输路由。它通过逻辑地址（如IP）来标识设备，并在不同的网络之间路由数据包。|![](https://s2.loli.net/2024/09/30/IUxJradHOgeS9Zz.png)|
|2|数据链路层|数据链路层负责在物理层上提供可靠的数据传输，处理错误检测、帧同步、流量控制等。它将比特流封装为帧（Frame），并在局域网或相邻节点之间传输数据。|![](https://s2.loli.net/2024/09/30/CyANG52TevzBHko.png)|
|1|物理层|物理层负责网络设备之间的实际物理连接，传输原始的比特流。它定义了数据如何在介质上传输，包括电压、电流、光纤信号等。|![](https://s2.loli.net/2024/09/30/uOWE3sPQ5gVTr6l.png)|
### TCP/IP五层模型

<img src="https://s2.loli.net/2024/09/30/HgNzWuryZsOEjth.png" style="zoom:67%;" />

物理层： 负责**光/电信号的传递**方式。比如现在以太网通用的网线（双绞线）、早期以太网采用的同轴电缆（现在主要用于有线电视）、光纤，现在的WiFi无线网使用的电磁波等都属于物理层的概念。物理层的能力决定了最大传输速率、传输距离、抗干扰性等。集线器（Hub）就是工作在物理层的。
数据链路层： 负责设备之间的**数据帧的传送和识别**。例如网卡设备的驱动、帧同步、冲突检测（如果检测到冲突就自动重发）、数据差错校验等工作。数据链路层底层的网络通信标准有很多，如以太网、令牌环网、无线LAN等。交换机（Switch）就是工作在数据链路层的。
网络层： 负责**地址管理和路由选择**。例如在IP协议中，通过IP地址来标识一台主机，并通过路由表的方式规划出两台主机之间数据传输的线路（路由）。路由器（Router）就是工作在网络层的。
传输层： 负责两台主机之间的**数据传输**。例如传输控制协议（TCP），能够确保数据可靠的从源主机发送到目标主机。
应用层： 负责**应用程序间沟通**。比如简单电子邮件传输（SMTP）、文件传输协议（FTP）、网络远程访问协议（Telnet）等。我们的网络编程主要就是针对应用层的。

​                                                                 <img src="https://s2.loli.net/2024/09/30/O9m7fLHhsXtN46x.jpg" />
两者的下面几层几乎是没有区别的，**操作系统**对应的是**传输层和网络层**，**数据链路层和物理层**都是对应在**驱动层**？的，而TCP/IP协议当中的**应用层**就对应到OSI七层协议当中的**应用层、表示层和会话层**。TCP/IP模型更简化，应用广泛，特别是在互联网和大多数网络环境中，是实际应用中的主流模型。

一般而言：
对于一台主机，它的操作系统内核实现了从传输层到物理层的内容。
对于一台路由器，它实现了从网络层到物理层的内容。
对于一台交换机，它实现了从数据链路层到物理层的内容。
对于集线器，它只实现了物理层的内容。
但这并不是绝对的，比如很多交换机也实现了网络层的转发，很多路由器也实现了部分传输层的内容（比如端口转发）。

## 网络传输

​                                                     <img src="https://s2.loli.net/2024/09/30/XQeDOAusoh2Ljnd.png" style="zoom:40%;" />

### 数据包封装

<img src="https://s2.loli.net/2024/09/30/GzcmVHIJZpQPb6l.png" style="zoom:50%;" />

**数据包封装**是指在网络通信中，将数据从应用层向下传输时，逐层添加协议头信息的过程。每一层都在其上面传输的数据包上添加自己的头部（和可能的尾部），以便提供必要的信息来处理和路由数据。

封装过程

- 应用层：生成应用数据（如HTTP请求）。数据被称为消息或数据。
- 表示层：对数据进行编码和转换（如果需要），通常这个过程在现代应用中被合并到应用层。
- 会话层：建立和管理会话，通常也合并在应用层。
- 传输层：将应用层数据封装为**段（Segment）**，添加TCP或UDP头部，包含源端口、目标端口、序列号等信息。
- 网络层：将传输层段封装为**数据包（Packet）**，添加IP头部，包括源IP地址、目标IP地址等信息。
- 数据链路层：将网络层数据包封装为**帧（Frame）**，添加MAC头部，包含源MAC地址、目标MAC地址等信息。
- 物理层：将帧转换为比特流，最终在物理媒介上传输。

假设一个HTTP请求从客户端发送到服务器：
-  应用层：`GET /index.html HTTP/1.1`
-  传输层：在上面添加TCP头部。
-  网络层：在上面添加IP头部。
-  数据链路层：在上面添加以太网头部。
  最终，这个请求通过物理层转换为电信号或光信号发送。

### 数据包分用  

<img src="https://s2.loli.net/2024/09/30/7jIlyQkUAnwvDcE.png" style="zoom:50%;" />

**数据包分用**是指在网络中多个用户或应用共享同一物理传输媒介的过程。在TCP/IP协议中，数据包分用通过不同的技术实现，如端口号、IP地址、虚拟专用网（VPN）等。

分用方式
- 端口分用：通过在传输层使用不同的端口号来区分不同的应用程序。例如，HTTP使用80端口，HTTPS使用443端口。多个应用程序可以通过同一IP地址和不同端口进行通信。
- IP地址分用：通过在网络层使用不同的IP地址来区分不同的主机。多个设备可以连接到同一网络，并通过不同的IP地址进行通信。
- 虚拟局域网（VLAN）：在数据链路层使用VLAN标签来区分不同的逻辑网络。即使多个VLAN共享同一物理网络，数据包在逻辑上是隔离的。
- 时间分复用：在一些网络中，数据传输使用时间片轮转的方式。每个用户在特定时间内独占传输带宽。
- 频率分复用：在无线网络中，不同的信号使用不同的频率进行传输，以避免干扰。

示例
在一个家庭网络中，多个设备（手机、电脑、平板）通过同一台路由器连接到互联网。路由器使用NAT（网络地址转换）技术，将内部设备的私有IP地址映射到一个公共IP地址，同时通过端口号将数据包分配到不同的设备上。

- **数据包封装**是将应用层数据逐层添加协议头信息的过程，确保数据能够在网络中正确传输。
- **数据包分用**是多个用户或应用共享同一物理传输媒介的方式，确保数据在不同应用之间能够正确分配和处理。


## 网络中地址管理

### IP地址
- IP 地址是用于标识网络上设备的逻辑地址。它可以在网络层进行路由和寻址。

- **IPv4:** 由四个字节（32 位）组成，通常表示为四个十进制数，如 192.168.1.1。
- **IPv6: **由八个十六进制数（128 位）组成，通常表示为八组十六进制数。
- 用于在互联网上定位和识别设备。支持数据包的路由，使数据能够在网络中传输到正确的目的地。

### MAC地址
- MAC 地址是网络接口控制器（NIC）的硬件地址，用于局域网中的设备识别。
- MAC 地址是在数据链路层（第二层）使用的，不参与路由。
- 由 6 个字节（48 位）组成，通常表示为 12 位十六进制数，如 00:1A:2B:3C:4D:5E。
- 每个网络接口在制造时都会被分配一个唯一的 MAC 地址，通常不可以修改。


### Linux下查看IP地址和mac地址
#### ifconfig
早期的网络配置工具，是Net-tools套件的一部分。早期广泛使用，但已经逐渐被废弃，许多现代Linux发行版默认不再安装该工具。**ifconfig**主要用于查看和配置网络接口、IP地址、子网掩码、启用或禁用网络接口等基本网络管理功能。它的功能相对有限，主要集中在传统的IPv4网络配置。
![](https://s2.loli.net/2024/09/30/2a7oEXfPdICxDyq.jpg)
![](https://s2.loli.net/2024/09/30/lOf1kGEbVUoYhgq.jpg)

#### ip addr
使用iproute2工具集，功能更加强大、灵活，支持更多现代网络功能，逐渐成为配置网络的主流工具。**ip addr**不仅可以完成ifconfig的所有功能，还支持更多高级网络配置功能，如：IPv4 和 IPv6 支持更好。配置多个IP地址（别名）给同一接口。更强的路由、策略路由、链路状态管理等。
![](https://s2.loli.net/2024/09/30/inJyLVhTYAEora7.jpg)

**lo(Loopback Interface):**lo 代表 回环接口，即 本地回环地址（Loopback）。它的主要作用是让设备自己与自己通信，用于测试**本机网络**功能，而无需发送数据到网络。通常，lo 接口绑定的是 127.0.0.1（IPv4） 或 ::1（IPv6），这是保留的特殊地址，用于指代本机。
**eth0(Ethernet Interface 0):**eth0 代表 第一个以太网接口。通常在有线网络设备（如网卡）上使用。eth0 是Linux系统中默认用于**外部网络通信**的网络接口之一。eth0 通常会被分配一个有效的 IPv4/IPv6 地址，用于设备通过以太网与其他网络设备进行通信。它的地址可能是手动配置的（静态）或通过DHCP自动分配的（动态）。
**广播地址 (Broadcast Address):**用于在局域网内发送数据给网络内所有主机的地址。它是子网内的最后一个地址，所有主机都可以接收到发送到该地址的数据包。
**子网掩码 (Subnet Mask):**用于将 IP 地址划分为网络部分和主机部分。它决定了一个网络中可以使用的主机范围。
**接口状态 (Interface State):**
> **<LOOPBACK,UP,LOWER UP> mtu 65536 qdisc noqueue state UNKNowN group default glen 1000**
> **<BROADCAST,MULTICAST,UP,LOWER UP> mtu 1500 qdisc pfifo fast state up group default glen 100e**
> **LOOPBACK:** 环回接口。
> **BROADCAST:** 广播发送数据包。
> **UP:** 接口已激活。
> **LOWER UP: **物理层已经激活，表明接口的底层链路是可用的。
> **BROADCAST:** 接口支持广播。
> **MULTICAST:** 支持多播通信。
> **qdisc pfifo_fast: **使用了 pfifo_fast 队列调度器，这是一种高效的队列处理方式。
> **state UP:** 接口运行正常，正在使用中。
> **mtu 1500:** 该接口的最大传输单元为 1500 字节
> **glen 1000:** 队列长度设置参数
